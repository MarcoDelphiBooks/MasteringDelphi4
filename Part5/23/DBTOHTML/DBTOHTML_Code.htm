<HTML><HEAD>
<TITLE>Project: DBTOHTML.DPR</TITLE>
<META NAME="GENERATOR" CONTENT="PasToHTML[Marco Cantù]">
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<CENTER><I>Marco Cant&ugrave; 1998, Mastering Delphi 4</I></CENTER>
<H1><CENTER>Project: DBTOHTML.DPR</CENTER></H1><HR>
<H3>Project Structure</H3><UL>
<LI> <A HREF=#DBTOHTML.DPR> DBTOHTML.DPR</A>
<LI> <A HREF=#DBHFORM.PAS> DBHFORM.PAS</A>
<LI> <A HREF=#DBHFORM.DFM> DBHFORM.DFM</A>
</UL>
<HR>
<A NAME=DBTOHTML.DPR><H3>DBTOHTML.DPR</H3></A>

<PRE>
<B>program</B> DbToHtml;

<B>uses</B>
  Forms,
  DBHForm <B>in</B> <I>'DBHForm.pas'</I> <FONT COLOR="#000080"><I>{Navigator}</I></FONT>;

<FONT COLOR="#000080"><I>{$R *.RES}</I></FONT>

<B>begin</B>
  Application.CreateForm(TNavigator, Navigator);
  Application.Run;
<B>end</B>.</PRE>
<HR>

<A NAME=DBHFORM.PAS><H3>DBHFORM.PAS</H3></A>

<PRE>
<B>unit</B> DBHForm;

<B>interface</B>

<B>uses</B>
  SysUtils, Windows, Messages, Classes, Graphics,
  Controls, Forms, DBCtrls, StdCtrls, DBTables,
  ExtCtrls, Mask, Db, Dialogs;

<B>type</B>
  TNavigator = <B>class</B>(TForm)
    BtnPrint: TButton;
    DBEdit3: TDBEdit;
    Label3: TLabel;
    Label2: TLabel;
    DBEdit2: TDBEdit;
    DBEdit1: TDBEdit;
    Label1: TLabel;
    DBNavigator1: TDBNavigator;
    Table1: TTable;
    DataSource1: TDataSource;
    SaveDialog1: TSaveDialog;
    Memo1: TMemo;
    Label4: TLabel;
    BtnSave: TButton;
    CheckStart: TCheckBox;
    BtnLine: TButton;
    <B>procedure</B> BtnPrintClick(Sender: TObject);
    <B>procedure</B> BtnSaveClick(Sender: TObject);
    <B>procedure</B> BtnLineClick(Sender: TObject);
  <B>public</B>
    <B>procedure</B> AddHeader (Str: TStrings; Title: <B>string</B>);
    <B>procedure</B> AddFooter (Str: TStrings);
    <B>procedure</B> AddAllLines (Str: TStrings);
  <B>end</B>;

<B>var</B>
  Navigator: TNavigator;

<B>implementation</B>

<FONT COLOR="#000080"><I>{$R *.DFM}</I></FONT>

<B>uses</B>
  ShellAPI;

<B>procedure</B> TNavigator.AddHeader (
  Str: TStrings; Title: <B>string</B>);
<B>begin</B>
  Str.Add (<I>'&lt;HTML&gt;'</I>);
  Str.Add (<I>'&lt;HEAD&gt;'</I>);
  Str.Add (<I>'&lt;TITLE&gt;'</I> + Title + <I>'&lt;/TITLE&gt;'</I>);
  Str.Add (<I>'&lt;/HEAD&gt;'</I>);
  Str.Add (<I>'&lt;BODY&gt;'</I>);
  Str.Add (<I>'&lt;H1&gt;&lt;CENTER&gt;'</I> + Title + <I>'&lt;/CENTER&gt;&lt;/H1&gt;'</I>);
<B>end</B>;

<B>procedure</B> TNavigator.AddFooter (Str: TStrings);
<B>begin</B>
  Str.Add (<I>'&lt;HR&gt;'</I>);
  Str.Add (<I>'Generated by the program '</I> +
    ExtractFilename (Application.Exename));
  Str.Add (<I>'&lt;/BODY&gt;'</I>);
  Str.Add (<I>'&lt;/HTML&gt;'</I>);
<B>end</B>;

<B>procedure</B> TNavigator.BtnPrintClick(Sender: TObject);
<B>begin</B>
  Memo1.Clear;
  AddHeader (Memo1.Lines,
    <I>'Table: '</I> + Table1.TableName);
  AddAllLines (Memo1.Lines);
  AddFooter (Memo1.Lines);
  BtnSave.Enabled := True;
<B>end</B>;

<B>procedure</B> TNAvigator.AddAllLines (Str: TStrings);
<B>var</B>
  Bookmark: TBookmark;
<B>begin</B>
  <FONT COLOR="#000080"><I>// disable the UI</I></FONT>
  Table1.DisableControls;
  <B>try</B>
    <FONT COLOR="#000080"><I>// store the current position</I></FONT>
    Bookmark := Table1.GetBookmark;
    <B>try</B>
      <FONT COLOR="#000080"><I>// scan the database table</I></FONT>
      Table1.First;
      <B>while</B> <B>not</B> Table1.EOF <B>do</B>
      <B>begin</B>
        <FONT COLOR="#000080"><I>// send the two fields</I></FONT>
        Str.Add (Format (<I>'The capital of %s is %s&lt;p&gt;'</I>,
          [Table1.FieldByName (<I>'Name'</I>).AsString,
          Table1.FieldByName (<I>'Capital'</I>).AsString]));
        Table1.Next;
      <B>end</B>;
    <B>finally</B>
      <FONT COLOR="#000080"><I>// go back to the bookmark and destroy it</I></FONT>
      Table1.GotoBookmark (Bookmark);
      Table1.FreeBookmark (Bookmark);
    <B>end</B>;
  <B>finally</B>
    <FONT COLOR="#000080"><I>// re-enable the controls</I></FONT>
    Table1.EnableControls;
  <B>end</B>;
<B>end</B>;

<B>procedure</B> TNavigator.BtnSaveClick(Sender: TObject);
<B>begin</B>
  <B>if</B> SaveDialog1.Execute <B>then</B>
  <B>begin</B>
    Memo1.Lines.SaveToFile (SaveDialog1.FileName);
    <B>if</B> CheckStart.Checked <B>then</B>
      ShellExecute (Handle, <I>'open'</I>,
        PChar (SaveDialog1.FileName),
        <I>''</I>, <I>''</I>, sw_ShowNormal);
  <B>end</B>;
<B>end</B>;

<B>procedure</B> TNavigator.BtnLineClick(Sender: TObject);
<B>var</B>
  I: Integer;
<B>begin</B>
  Memo1.Clear;
  AddHeader (Memo1.Lines, Table1.Fields[0].AsString);
  <B>for</B> I := 1 <B>to</B> Table1.FieldCount - 1 <B>do</B>
    Memo1.Lines.Add (Table1.Fields [I].FieldName + <I>': '</I> +
      Table1.Fields [I].AsString + <I>'&lt;p&gt;'</I>);
  AddFooter (Memo1.Lines);
  BtnSave.Enabled := True;
<B>end</B>;

<B>end</B>.</PRE>
<HR>

<A NAME=DBHFORM.DFM><H3>DBHFORM.DFM</H3></A>

<PRE>
<B>object</B> Navigator: TNavigator
  Left = 190
  Top = 108
  Width = 427
  Height = 380
  Caption = <I>'Navigator'</I>
  Color = clBtnFace
  Font.Charset = DEFAULT_CHARSET
  Font.Color = clBlack
  Font.Height = -11
  Font.Name = <I>'MS Sans Serif'</I>
  Font.Style = []
  OldCreateOrder = True
  PixelsPerInch = 96
  TextHeight = 13
  <B>object</B> Label3: TLabel
    Left = 40
    Top = 124
    Width = 48
    Height = 13
    Caption = <I>'Continent:'</I>
  <B>end</B>
  <B>object</B> Label2: TLabel
    Left = 40
    Top = 91
    Width = 35
    Height = 13
    Caption = <I>'Capital:'</I>
  <B>end</B>
  <B>object</B> Label1: TLabel
    Left = 40
    Top = 56
    Width = 39
    Height = 13
    Caption = <I>'Country:'</I>
  <B>end</B>
  <B>object</B> Label4: TLabel
    Left = 40
    Top = 152
    Width = 71
    Height = 13
    Caption = <I>'HTML Preview'</I>
  <B>end</B>
  <B>object</B> BtnPrint: TButton
    Left = 296
    Top = 82
    Width = 89
    Height = 25
    Caption = <I>'&amp;Print All'</I>
    TabOrder = 0
    OnClick = BtnPrintClick
  <B>end</B>
  <B>object</B> DBEdit3: TDBEdit
    Left = 104
    Top = 120
    Width = 169
    Height = 21
    DataField = <I>'Continent'</I>
    DataSource = DataSource1
    TabOrder = 1
  <B>end</B>
  <B>object</B> DBEdit2: TDBEdit
    Left = 104
    Top = 86
    Width = 169
    Height = 21
    DataField = <I>'Capital'</I>
    DataSource = DataSource1
    MaxLength = 24
    TabOrder = 2
  <B>end</B>
  <B>object</B> DBEdit1: TDBEdit
    Left = 104
    Top = 52
    Width = 169
    Height = 21
    DataField = <I>'Name'</I>
    DataSource = DataSource1
    MaxLength = 24
    TabOrder = 3
  <B>end</B>
  <B>object</B> DBNavigator1: TDBNavigator
    Left = 0
    Top = 0
    Width = 419
    Height = 25
    DataSource = DataSource1
    VisibleButtons = [nbFirst, nbPrior, nbNext, nbLast, nbInsert, nbEdit, nbPost, nbCancel]
    Align = alTop
    Flat = True
    TabOrder = 4
  <B>end</B>
  <B>object</B> Memo1: TMemo
    Left = 40
    Top = 176
    Width = 345
    Height = 153
    TabOrder = 5
  <B>end</B>
  <B>object</B> BtnSave: TButton
    Left = 296
    Top = 122
    Width = 89
    Height = 25
    Caption = <I>'Save HTML'</I>
    Enabled = False
    TabOrder = 6
    OnClick = BtnSaveClick
  <B>end</B>
  <B>object</B> CheckStart: TCheckBox
    Left = 296
    Top = 150
    Width = 89
    Height = 17
    Caption = <I>'Start Browser'</I>
    Checked = True
    State = cbChecked
    TabOrder = 7
  <B>end</B>
  <B>object</B> BtnLine: TButton
    Left = 296
    Top = 52
    Width = 89
    Height = 25
    Caption = <I>'Print &amp;Line'</I>
    TabOrder = 8
    OnClick = BtnLineClick
  <B>end</B>
  <B>object</B> Table1: TTable
    Active = True
    DatabaseName = <I>'DBDEMOS'</I>
    TableName = <I>'COUNTRY.DB'</I>
    Left = 16
    Top = 48
  <B>end</B>
  <B>object</B> DataSource1: TDataSource
    DataSet = Table1
    Left = 16
    Top = 96
  <B>end</B>
  <B>object</B> SaveDialog1: TSaveDialog
    DefaultExt = <I>'HTM'</I>
    Filter = <I>'HTML file (*.htm)|*.htm|Any file (*.*)|*.*'</I>
    Options = [ofOverwritePrompt, ofPathMustExist, ofCreatePrompt]
    Left = 16
  <B>end</B>
<B>end</B></PRE>
<HR>

<BR><I><CENTER>Copyright Marco Cant&ugrave; 1998</CENTER></I>
</BODY> </HTML>